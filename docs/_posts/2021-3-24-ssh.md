---
title: sshçš„ç®€å•è¿ç”¨ðŸ†
date: 2021-3-24
author: å¼ è¶Š
tags:
    - ssh
    - git
location: DaLian
---

# ssh çš„ç®€å•è¿ç”¨ ðŸŒ¼

æœ¬æ–‡æ˜¯æˆ‘åœ¨é¡¹ç›®éƒ¨ç½²ä¹‹åŽçš„æ€»ç»“ç¬”è®° âœ,è®°å½•äº† SSH çš„ç®€å•è¿ç”¨

## ä»€ä¹ˆæ˜¯ SSHï¼Ÿ

`SSH` ä¸º Secure Shell çš„ç¼©å†™ï¼Œç”± IETF çš„ç½‘ç»œå°ç»„ï¼ˆNetwork Working Groupï¼‰æ‰€åˆ¶å®šï¼›SSH ä¸ºå»ºç«‹åœ¨åº”ç”¨å±‚åŸºç¡€ä¸Šçš„å®‰å…¨åè®®ã€‚SSH æ˜¯è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨ SSH åè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚SSH æœ€åˆæ˜¯ UNIX ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç¨‹åºï¼ŒåŽæ¥åˆè¿…é€Ÿæ‰©å±•åˆ°å…¶ä»–æ“ä½œå¹³å°ã€‚SSH åœ¨æ­£ç¡®ä½¿ç”¨æ—¶å¯å¼¥è¡¥ç½‘ç»œä¸­çš„æ¼æ´žã€‚SSH å®¢æˆ·ç«¯é€‚ç”¨äºŽå¤šç§å¹³å°ã€‚å‡ ä¹Žæ‰€æœ‰ UNIX å¹³å°â€”åŒ…æ‹¬ HP-UXã€Linuxã€AIXã€Solarisã€Digital UNIXã€Irixï¼Œä»¥åŠå…¶ä»–å¹³å°ï¼Œéƒ½å¯è¿è¡Œ SSHã€‚(ç™¾åº¦ç™¾ç§‘)

`å…¶å®žå°±æ˜¯ç«¯åˆ°ç«¯çš„ä¸€ç§åŠ å¯†çš„ç½‘ç»œä¼ è¾“åè®®ï¼Œä¸€èˆ¬ç”¨äºŽlinuxã€‚`

## SSH çš„ä¿©ç§è¿žæŽ¥æ–¹å¼

### å¯†ç ç™»å½•

```bash
$ ssh user@host -p
# user è¿œç¨‹æœåŠ¡å™¨çš„ç”¨æˆ·
# host è¿œç¨‹æœåŠ¡å™¨çš„ä¸»æœºåæˆ–è€…IPåœ°å€
```

ç¬¬ä¸€æ¬¡ç™»å½•ä¼šå‡ºçŽ°ä¸‹é¢æç¤º ðŸ‘‡ï¼š

```bash
ã€€ã€€The authenticity of host 'host (xx.xx.xx.xx))' can't be established.
ã€€ã€€RSA key fingerprint is xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx.
ã€€ã€€Are you sure you want to continue connecting (yes/no)?
```

ä¸Šé¢çš„æ„æ€æ˜¯,æ— æ³•ç¡®è®¤ host ä¸»æœºçš„çœŸå®žæ€§ï¼ŒåªçŸ¥é“å®ƒçš„å…¬é’¥æŒ‡çº¹ï¼Œä½ ç¡®å®šè¦ç»§ç»­è¿žæŽ¥å—ï¼Ÿ

`å…¬é’¥æŒ‡çº¹`ï¼šå…¬é’¥ä¸€èˆ¬éƒ½æ¯”è¾ƒé•¿ï¼ˆé‡‡ç”¨ RSA ç®—æ³•ï¼Œé•¿è¾¾ 1024 ä½ï¼‰ï¼Œæ¯”è¾ƒéš¾å¯¹æ¯”ï¼Œæ‰€ä»¥å¯¹å…¶è¿›è¡Œäº† MD5 æˆ–è€… SHA256 è®¡ç®—ï¼Œå°†å®ƒå˜æˆä¸€ä¸ª 128 ä½çš„æŒ‡çº¹ï¼ˆä¸Šé¢æ˜¯ 16 è¿›åˆ¶è¡¨ç¤ºï¼‰ï¼Œå†è¿›è¡Œæ¯”è¾ƒï¼Œå°±ç›¸å¯¹ç®€å•äº†ä¸€äº›

é‚£å¦‚ä½•å¯¹æ¯”å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ²¡æœ‰å¥½åŠžæ³•ï¼Œéœ€è¦è‡ªå·±åŽ»è¿œç¨‹æœåŠ¡å™¨ä¸Šé€šè¿‡ä»¥ä¸‹å‘½ä»¤ç¡®è®¤ ðŸ‘‡

```bash
$ ssh-keygen -lf ~/.ssh/id_rsa.pub
```

è¾ƒæ–°çš„ SSH å‘½ä»¤ä¼šå°†æŒ‡çº¹åˆ—ä¸º`SHA256`å¯†é’¥  
å¦‚æžœéœ€è¦å°†å…¶ä¸Žæ—§æŒ‡çº¹è¿›è¡Œæ¯”è¾ƒï¼Œè¿˜éœ€è¦æŒ‡å®šä½¿ç”¨ MD5 æŒ‡çº¹æ•£åˆ—å‡½æ•°ã€‚

```bash
ssh-keygen -E md5 -lf ~/.ssh/id_dsa.pub
```

ç»è¿‡ç¡®è®¤ä»¥åŽï¼Œå†³å®šæŽ¥å—è¿™ä¸ªè¿œç¨‹ä¸»æœºçš„å…¬é’¥ã€‚

```bash
Are you sure you want to continue connecting (yes/no)? yes
```

shell ç´§æŽ¥ç€ä¼šå‡ºçŽ°ä»¥ä¸‹æç¤ºï¼Œè¡¨ç¤º host ä¸»æœºå·²ç»å¾—åˆ°è®¤å¯ã€‚

```bash
Warning: Permanently added 'host,xx.xx.xx.xx' (RSA) to the list of known hosts.
```

ç´§æŽ¥ç€ä¼šè®©ä½ è¾“å…¥å¯†ç ï¼ˆè¿œç¨‹æœåŠ¡å™¨ç™»å½•å¯†ç ï¼‰

```bash
Password: (enter password)
```

å¯†ç æ­£ç¡®å³ä¼šç™»å½•æˆåŠŸ  
åˆæ¬¡ç™»å½•æˆåŠŸåŽï¼Œè¿œç¨‹ host çš„å…¬é’¥å°±ä¼šè¢«ä¿å­˜åœ¨æ–‡ä»¶~/.ssh/known_hosts ä¸­ï¼Œä¸‹æ¬¡åœ¨è¿žæŽ¥è¿™å° hostï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«åˆ°è¿™å°å…¬é’¥å·²ç»ä¿å­˜åœ¨æœ¬åœ°äº†ï¼Œä»Žè€Œè·³è¿‡è­¦å‘Šéƒ¨åˆ†ï¼Œç›´æŽ¥æç¤ºè¾“å…¥å¯†ç 

### å…å¯†ç™»å½•

æ¯æ¬¡ç™»å½•éƒ½éœ€è¦è¾“å…¥å¯†ç ï¼Œéžå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥å°±éœ€è¦æ¢ä¸€ç§æ–¹å¼ç™»å½•->å…å¯†ç™»å½•

å…å¯†ç™»å½•åŽŸç†ï¼šå°±æ˜¯ç”¨æˆ·å°†è‡ªå·±çš„å…¬é’¥å‚¨å­˜åœ¨è¿œç¨‹ä¸»æœºä¸Šã€‚ç™»å½•çš„æ—¶å€™ï¼Œè¿œç¨‹ä¸»æœºä¼šå‘ç”¨æˆ·å‘é€ä¸€æ®µéšæœºå­—ç¬¦ä¸²ï¼Œç”¨æˆ·ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†åŽï¼Œå†å‘å›žæ¥ã€‚è¿œç¨‹ä¸»æœºç”¨äº‹å…ˆå‚¨å­˜çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¦‚æžœæˆåŠŸï¼Œå°±è¯æ˜Žç”¨æˆ·æ˜¯å¯ä¿¡çš„ï¼Œç›´æŽ¥å…è®¸ç™»å½• shellï¼Œä¸å†è¦æ±‚å¯†ç ã€‚

è¿™æ—¶å€™å°±éœ€è¦é€šè¿‡`ssh-keygen`ç”Ÿæˆç§˜é’¥å¯¹ ðŸ‘‡ï¼š

```bash
ssh-keygen -t rsa -f ~/.ssh/id_rsa -C xxx
# -t: å¯†é’¥ç±»åž‹, å¯ä»¥é€‰æ‹© dsa | ecdsa | ed25519 | rsa; çœç•¥çš„æƒ…å†µä¸‹é»˜è®¤æ˜¯rsa
# -f: å¯†é’¥ç›®å½•ä½ç½®,æŒ‡å®šç”Ÿæˆå¯†é’¥çš„ä¿å­˜è·¯å¾„å’Œæ–‡ä»¶åã€‚çœç•¥çš„æƒ…å†µä¸‹ï¼Œ é»˜è®¤ä¸ºå½“å‰ç”¨æˆ·homeè·¯å¾„ä¸‹çš„.sshéšè—ç›®å½•, ä¹Ÿå°±æ˜¯~/.ssh/, åŒæ—¶é»˜è®¤å¯†é’¥æ–‡ä»¶åä»¥id_rsaå¼€å¤´.
# -C: æŒ‡å®šæ­¤å¯†é’¥çš„å¤‡æ³¨ä¿¡æ¯, éœ€è¦é…ç½®å¤šä¸ªå…å¯†ç™»å½•æ—¶, å»ºè®®æºå¸¦;ç”Ÿæˆçš„å…¬é’¥ä¼šåœ¨æœ€åŽé¢æ˜¾ç¤ºæ­¤å¤‡æ³¨ä¿¡æ¯
```

è¿è¡Œç»“æŸåŽï¼Œåœ¨~/.ssh/ç›®å½•ä¸‹ï¼Œä¼šæ–°ç”Ÿæˆä¿©ä¸ªæ–‡ä»¶ï¼šid_rsa.pub å’Œ id_rsaã€‚å‰è€…æ˜¯å…¬é’¥ï¼ŒåŽè€…æ˜¯ç§é’¥ã€‚  
å¤‡æ³¨ï¼šåœ¨æœªæŒ‡å®šç§é’¥æ—¶ï¼Œid_rsa ç§é’¥æ˜¯è¿žæŽ¥ä»»æ„ host æ—¶ä½¿ç”¨çš„ç§é’¥(/etc/ssh/ssh_config)

æŽ¥ç€éœ€è¦å°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹ host çš„~/.ssh/authorized_keys æ–‡ä»¶ä¸­

```bash
ã€€$ ssh user@host 'mkdir -p .ssh && cat >> .ssh/authorized_keys' < ~/.ssh/id_rsa.pub
```

è¿™æ¡å‘½ä»¤ç”±å¤šä¸ªè¯­å¥ç»„æˆï¼Œä¾æ¬¡åˆ†è§£å¼€æ¥çœ‹ï¼š  
ï¼ˆ1ï¼‰"$ ssh user@host"ï¼Œè¡¨ç¤ºç™»å½•è¿œç¨‹ä¸»æœºï¼›  
ï¼ˆ2ï¼‰å•å¼•å·ä¸­çš„mkdir .ssh && cat >> .ssh/authorized_keysï¼Œè¡¨ç¤ºç™»å½•åŽåœ¨è¿œç¨‹shellä¸Šæ‰§è¡Œçš„å‘½ä»¤ï¼š  
ï¼ˆ3ï¼‰"$ mkdir -p .ssh"çš„ä½œç”¨æ˜¯ï¼Œå¦‚æžœç”¨æˆ·ä¸»ç›®å½•ä¸­çš„.ssh ç›®å½•ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºä¸€ä¸ªï¼›  
ï¼ˆ4ï¼‰'cat >> .ssh/authorized_keys' < ~/.ssh/id_rsa.pub çš„ä½œç”¨æ˜¯ï¼Œå°†æœ¬åœ°çš„å…¬é’¥æ–‡ä»¶~/.ssh/id_rsa.pubï¼Œé‡å®šå‘è¿½åŠ åˆ°è¿œç¨‹æ–‡ä»¶ authorized_keys çš„æœ«å°¾ã€‚
è¿™ä¸ªå‘½ä»¤æˆ‘éœ€è¦åŽç»­çš„éªŒè¯

åŽç»­å°±å¯ä»¥ç›´æŽ¥è¿›è¡Œ ssh å…å¯†ç™»å½•äº†

## ç§é’¥å¤ªå¤šæ€Žä¹ˆåŠžï¼Ÿ

åœºæ™¯:å½“ä½ çš„ç”µè„‘éœ€è¦ç»å¸¸ ssh ä¸åŒçš„æœåŠ¡å™¨æ—¶ï¼Œä¸åŒçš„æœåŠ¡å™¨éœ€è¦ä¸åŒçš„ç§é’¥æ¥è¿žæŽ¥ï¼Œè¿™æ—¶å€™ä½ å°±éœ€è¦åœ¨è¿žæŽ¥æ—¶æŒ‡å®šç§é’¥ï¼Œè¿™æ ·æ¯”è¾ƒéº»çƒ¦

### ä½¿ç”¨`ssh-agent`

ssh-agent æ˜¯ä¸€ç§æŽ§åˆ¶ç”¨æ¥ä¿å­˜å…¬é’¥èº«ä»½éªŒè¯æ‰€ä½¿ç”¨çš„ç§é’¥çš„ç¨‹åºï¼Œå…¶å®ž ssh-agent å°±æ˜¯ä¸€ä¸ªå¯†é’¥ç®¡ç†å™¨ï¼Œè¿è¡Œ ssh-agent ä»¥åŽï¼Œä½¿ç”¨ ssh-add å°†ç§é’¥äº¤ç»™ ssh-agent ä¿ç®¡ï¼Œå…¶ä»–ç¨‹åºéœ€è¦èº«ä»½éªŒè¯çš„æ—¶å€™å¯ä»¥å°†éªŒè¯ç”³è¯·äº¤ç»™ ssh-agent æ¥å®Œæˆæ•´ä¸ªè®¤è¯è¿‡ç¨‹ã€‚  
å¤‡æ³¨ï¼šåœ¨æˆ‘ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œssh-agent åœ¨ä¼šè¯ç»“æŸ(shell å…³é—­)å°±åœæ­¢äº†ï¼Œæ¯æ¬¡éƒ½éœ€è¦ ssh-agent bash å¯åŠ¨ï¼Œç„¶åŽé€šè¿‡ ssh-add xxx æ·»åŠ ç§é’¥  
å¯ä»¥é€šè¿‡ ssh-add -l æŸ¥çœ‹ç¼“å­˜åŒºå†…çš„ç§é’¥(ç§˜é’¥æŒ‡çº¹æ˜¾ç¤º)ï¼Œä¸ä¼šæ˜¾ç¤ºé»˜è®¤ç§˜é’¥

å‚è€ƒæ–‡ç« ï¼š[https://zhuanlan.zhihu.com/p/126117538](https://zhuanlan.zhihu.com/p/126117538)

### åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨~/.ssh/ç›®å½•ä¸‹åˆ›å»º config æ–‡ä»¶,ä¾‹å¦‚ï¼š

```conf
Host git

    HostName github.com

    Port 22

    User git

    IdentityFile ~/xxxx #ç§é’¥çš„è·¯å¾„
```

è¿™æ ·ä»¥åŽè¿žæŽ¥å°±å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤

```bash
   ssh -T git
   # -T:æµ‹è¯•è¿žæŽ¥
```

## å¤§ç™½è¯ç†è§£å…¬é’¥ ðŸ”“ å’Œç§é’¥ ðŸ”‘

å…¬é’¥å°±æ˜¯é”ï¼Œç§é’¥å°±æ˜¯é’¥åŒ™ï¼Œå½“ä½ æ‹¿åˆ°è¿™å¥—è£…å¤‡æ—¶ï¼Œé¦–å…ˆéœ€è¦å°†é”å®‰è£…åˆ°é—¨ä¸Šï¼ˆauthorized_keysï¼‰ï¼Œç„¶åŽé€šè¿‡é’¥åŒ™ï¼ˆç§é’¥ï¼‰æ¥è§£é”ï¼Œç”±äºŽæœ‰å®¶äººï¼Œæ‰€ä»¥å®¶äººä¹Ÿä¼šæœ‰é’¥åŒ™ï¼ˆç§é’¥ï¼‰ï¼Œåˆå› ä¸ºå®¶é‡Œé¢é”å¾ˆå¤šï¼Œéœ€è¦ä¸åŒçš„é’¥åŒ™æ¥è§£é”ï¼Œé’¥åŒ™å¤šäº†ä¸å®¹æ˜“è®°ä½ï¼Œæ‰€ä»¥å¯ä»¥ç»™é’¥åŒ™ä¸Šé¢è´´ä¸ªæ¡ ðŸ“„ æ ‡æ³¨å“ªä¸ªé”ï¼ˆåˆ©ç”¨é…ç½®æ–‡ä»¶å¿«é€Ÿè¿žæŽ¥ï¼‰ã€‚  
 å¤‡æ³¨ï¼šè¿™å¥—é”å’Œé’¥åŒ™ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ä¸€ä¸ªåœ°æ–¹(copy)ï¼Œåªè¦æ˜¯èƒ½ä¸Šé”çš„åœ°æ–¹éƒ½èƒ½ç”¨ï¼ˆä¸€å¯¹ç§˜é’¥å¯¹å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨ï¼‰

## git clone ä¿©ç§æ–¹å¼çš„åŒºåˆ«

`HTTPS`ï¼šä¸ç®¡æ˜¯è°ï¼Œæ‹¿åˆ° url éšä¾¿ cloneï¼Œä½†æ˜¯åœ¨ push çš„æ—¶å€™éœ€è¦éªŒè¯ç”¨æˆ·åå’Œå¯†ç ã€‚  
`SSH`ï¼šclone çš„é¡¹ç›®ä½ å¿…é¡»æ˜¯æ‹¥æœ‰è€…æˆ–è€…ç®¡ç†å‘˜ï¼Œè€Œä¸”éœ€è¦åœ¨ clone å‰æ·»åŠ  SSH Keyã€‚SSH åœ¨ push çš„æ—¶å€™ï¼Œæ˜¯ä¸éœ€è¦è¾“å…¥ç”¨æˆ·åçš„ï¼Œå¦‚æžœé…ç½® SSH key çš„æ—¶å€™è®¾ç½®äº†å¯†ç ï¼ˆpassparseï¼‰ï¼Œåˆ™éœ€è¦è¾“å…¥å¯†ç çš„ï¼Œå¦åˆ™ç›´æŽ¥æ˜¯ä¸éœ€è¦è¾“å…¥å¯†ç çš„ã€‚

## å¤‡æ³¨ â—

`~` :å½“å‰ç”¨æˆ·çš„æ ¹ç›®å½•  
 æ™®é€šç”¨æˆ·ä¸€èˆ¬åœ¨/home/xxx  
 root çš„æ ¹ç›®å½•åœ¨/root

`passparse` :ç§é’¥çš„å¯†ç ã€‚å¦‚æžœæ‹…å¿ƒç§é’¥çš„å®‰å…¨ï¼Œå¯ä»¥åœ¨ç”Ÿæˆç§˜é’¥å¯¹çš„æ—¶å€™è®¾ç½®ï¼Œå°±ä¼šåŠ å¯†ç§é’¥ï¼Œåœ¨ä½¿ç”¨ç§é’¥æ—¶éƒ½ä¼šè®©ä½ è¾“å…¥ passparse æ¥è§£å¯†ã€‚

`/etc/ssh/ssh_config`:å…¨å±€çš„ ssh`å®¢æˆ·ç«¯`é…ç½®æ–‡ä»¶ã€‚é‡Œé¢æ˜¯é»˜è®¤é…ç½®ï¼ŒæŒ‡å®šäº†~/.ssh/id_rsa ä¸ºé»˜è®¤ç§é’¥ï¼Œè¿˜æœ‰å¾ˆå¤šé…ç½®æœ‰å¾…å‘æŽ˜...

æŽ¥ä¸€ä¸ª ssh å‘½ä»¤çš„å›¾æœ€å¥½
